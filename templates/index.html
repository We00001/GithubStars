<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ T.page_title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .truncate-multiline {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        body {
            background-color: #111827;
            color: #d1d5db;
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        .form-select, .form-input {
            background-color: #374151;
            color: #d1d5db;
            border: 1px solid #4b5563;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #4b5563;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #6b7280;
        }
        .pagination-link {
            background-color: #374151;
            color: #d1d5db;
            border: 1px solid #4b5563;
        }
        .pagination-link.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .error-message {
            background-color: #4b1d1d;
            border: 1px solid #993030;
            color: #fecaca;
        }
    </style>
</head>
<body class="font-sans">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- Header and Language Selector -->
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-white">{{ T.main_header }}</h1>
                <p class="text-gray-400">{{ T.sub_header }}</p>
            </div>
            <div class="flex items-center space-x-4">
                <a href="{{ url_for_params('index', lang='en') }}" class="text-sm {{ 'font-bold text-white' if lang == 'en' else 'text-gray-400 hover:text-white' }}">EN</a>
                <span class="text-gray-500">|</span>
                <a href="{{ url_for_params('index', lang='zh') }}" class="text-sm {{ 'font-bold text-white' if lang == 'zh' else 'text-gray-400 hover:text-white' }}">中文</a>
            </div>
        </header>

        {% if error %}
            <div class="card p-4 rounded-lg mb-6 error-message text-center">
                {{ error }}
            </div>
        {% else %}
        <!-- Controls -->
        <div class="card p-4 rounded-lg mb-6">
            <form method="GET" action="{{ url_for('index') }}" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <input type="hidden" name="lang" value="{{ lang }}">
                <div>
                    <label for="date" class="block text-sm font-medium mb-1">{{ T.select_date }}</label>
                    <select id="date" name="date" class="form-select w-full rounded-md" onchange="this.form.submit()">
                        {% for d in date_cols %}
                        <option value="{{ d }}" {% if d == selected_date %}selected{% endif %}>{{ d }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="growth_days" class="block text-sm font-medium mb-1">{{ T.growth_period }}</label>
                    <select id="growth_days" name="growth_days" class="form-select w-full rounded-md" onchange="this.form.submit()">
                        <option value="1" {% if growth_days == 1 %}selected{% endif %}>1 {{ T.day }}</option>
                        <option value="7" {% if growth_days == 7 %}selected{% endif %}>7 {{ T.days }}</option>
                        <option value="30" {% if growth_days == 30 %}selected{% endif %}>30 {{ T.days }}</option>
                        <option value="365" {% if growth_days == 365 %}selected{% endif %}>1 {{ T.year }}</option>
                    </select>
                </div>
                <div>
                    <label for="sort_by" class="block text-sm font-medium mb-1">{{ T.sort_by }}</label>
                    <select id="sort_by" name="sort_by" class="form-select w-full rounded-md" onchange="this.form.submit()">
                        <option value="stars" {% if sort_by == 'stars' %}selected{% endif %}>{{ T.stars }}</option>
                        <option value="growth" {% if sort_by == 'growth' %}selected{% endif %}>{{ T.growth }}</option>
                    </select>
                </div>
            </form>
        </div>

        <!-- Day Navigation -->
        <div class="flex justify-between items-center my-4">
            {% if prev_date %}
                <a href="{{ url_for_params('index', date=prev_date) }}" class="btn-secondary px-4 py-2 rounded-md">&larr; {{ T.prev_day }}</a>
            {% else %}
                <span></span>
            {% endif %}
            {% if next_date %}
                <a href="{{ url_for_params('index', date=next_date) }}" class="btn-secondary px-4 py-2 rounded-md">{{ T.next_day }} &rarr;</a>
            {% else %}
                <span></span>
            {% endif %}
        </div>

        <!-- Data Table -->
        <div class="card rounded-lg overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-800">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">{{ T.title }}</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                            <a href="{{ url_for_params('index', sort_by='stars', order='desc' if order == 'asc' and sort_by == 'stars' else 'asc') }}" class="hover:text-white">
                                {{ T.stars }}
                                {% if sort_by != 'stars' %}
                                    <span class="text-gray-500">&#9650;&#9660;</span>
                                {% elif order == 'desc' %}
                                    <span>&#9660;</span>
                                {% else %}
                                    <span>&#9650;</span>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
                             <a href="{{ url_for_params('index', sort_by='growth', order='desc' if order == 'asc' and sort_by == 'growth' else 'asc') }}" class="hover:text-white">
                                {{ T.growth }} ({{ growth_days }}{{ T.day if growth_days == 1 else T.days }})
                                {% if sort_by != 'growth' %}
                                    <span class="text-gray-500">&#9650;&#9660;</span>
                                {% elif order == 'desc' %}
                                    <span>&#9660;</span>
                                {% else %}
                                    <span>&#9650;</span>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">{{ T.links }}</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    {% if data %}
                        {% for row in data %}
                        <tr class="hover:bg-gray-700/50">
                            <td class="px-6 py-4 whitespace-normal max-w-md">
                                <div class="truncate-multiline font-medium text-white">{{ row.Title }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-lg font-semibold text-white">{{ row.current_stars | int }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {% if row.growth is not none and row.growth is number %}
                                    <span class="{{ 'text-green-400' if row.growth > 0 else 'text-red-400' if row.growth < 0 else 'text-gray-400' }}">
                                        {{ '+%d' | format(row.growth | int) if row.growth > 0 else row.growth | int }}
                                    </span>
                                {% else %}
                                    <span class="text-gray-500">N/A</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-lg space-x-4">
                                {% if row.Pdf_Link and row.Pdf_Link != 'not_found' %}
                                <a href="{{ row.Pdf_Link }}" target="_blank" title="ArXiv PDF" class="text-red-500 hover:text-red-400"><i class="fas fa-file-pdf"></i></a>
                                {% endif %}
                                {% if row.Github_Link and row.Github_Link != 'not_found' and 'https://' in row.Github_Link %}
                                <a href="{{ row.Github_Link }}" target="_blank" title="GitHub Repository" class="text-gray-300 hover:text-white"><i class="fab fa-github"></i></a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center py-10 text-gray-500">{{ T.no_data }}</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="mt-6 flex items-center justify-between">
            <p class="text-sm text-gray-400">
                {{ T.showing }} {{ start_index + 1 }} {{ T.to }} {{ end_index }} {{ T.of }} {{ total_items }} {{ T.results }}
            </p>
            <nav class="flex items-center space-x-2">
                {% if page > 1 %}
                <a href="{{ url_for_params('index', page=page-1) }}" class="pagination-link px-3 py-1 rounded-md">&laquo; {{ T.prev }}</a>
                {% endif %}

                {% set page_start = [1, page - 2] | max %}
                {% set page_end = [total_pages, page + 2] | min %}

                {% if page_start > 1 %}
                    <a href="{{ url_for_params('index', page=1) }}" class="pagination-link px-3 py-1 rounded-md">1</a>
                    {% if page_start > 2 %}<span class="px-3 py-1">...</span>{% endif %}
                {% endif %}

                {% for p in range(page_start, page_end + 1) %}
                    <a href="{{ url_for_params('index', page=p) }}" class="pagination-link px-3 py-1 rounded-md {{ 'active' if p == page else '' }}">{{ p }}</a>
                {% endfor %}

                {% if page_end < total_pages %}
                     {% if page_end < total_pages - 1 %}<span class="px-3 py-1">...</span>{% endif %}
                    <a href="{{ url_for_params('index', page=total_pages) }}" class="pagination-link px-3 py-1 rounded-md">{{ total_pages }}</a>
                {% endif %}

                {% if page < total_pages %}
                <a href="{{ url_for_params('index', page=page+1) }}" class="pagination-link px-3 py-1 rounded-md">{{ T.next }} &raquo;</a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
        {% endif %}
    </div>
</body>
</html>

